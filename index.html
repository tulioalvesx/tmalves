<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TMA CORP • Notícias de Telecom</title>
  <meta name="description" content="Cobertura quase em tempo real das principais fontes de Telecom no Brasil. Atualização automática via RSS." />
  <link rel="icon" href="logo-escudo.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
    .news-grid { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); }
    .pulse { animation: pulse 1.5s ease-in-out infinite; }
    @keyframes pulse { 0%{opacity:.6} 50%{opacity:1} 100%{opacity:.6} }
    /* Floating WhatsApp */
    .whats-float { position: fixed; right: 1rem; bottom: 1rem; width: 58px; height: 58px; border-radius: 9999px;
      display: grid; place-items:center; background: #25D366; box-shadow: 0 6px 24px rgba(0,0,0,.18); z-index: 60; }
    .whats-float img { width: 30px; height: 30px; filter: drop-shadow(0 2px 2px rgba(0,0,0,.15)); }
    .whats-float:hover { transform: scale(1.05); box-shadow: 0 10px 30px rgba(0,0,0,.25); transition: all .2s ease; }
  </style>
</head>
<body class="bg-neutral-50 text-neutral-900">
  <!-- Header -->
  <header class="sticky top-0 z-50 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 border-b">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center gap-4">
      <img src="logo-escudo.png" alt="TMA CORP" class="w-10 h-10 rounded" />
      <div class="flex-1">
        <h1 class="text-xl md:text-2xl font-bold tracking-tight">TMA CORP • Notícias de Telecom</h1>
        <p class="text-xs md:text-sm text-neutral-600">Atualiza automaticamente das fontes originais • estilo G1</p>
      </div>
      <div class="flex items-center gap-3">
        <a href="https://www.instagram.com/tulio.alvesx?igsh=MXJ3N3QyODc4bmVlcQ%3D%3D&utm_source=qr" target="_blank" title="Instagram">
          <img src="instagram-icone-icon.png" alt="Instagram" class="w-7 h-7 rounded-md" />
        </a>
        <a href="https://wa.me/5535998993464" target="_blank" title="WhatsApp">
          <img src="WhatsApp-icone.png" alt="WhatsApp" class="w-7 h-7 rounded-full" />
        </a>
      </div>
    </div>
  </header>

  <!-- Top Bar: filtros e busca -->
  <section class="border-b bg-white">
    <div class="max-w-7xl mx-auto px-4 py-3 flex flex-col md:flex-row gap-3 md:items-center md:justify-between">
      <div class="flex items-center gap-2 text-sm text-neutral-600">
        <span class="inline-flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-emerald-500" id="led"></span><span id="statusText">Pronto</span></span>
        <span class="hidden md:inline">•</span>
        <span>Atualiza a cada <strong id="refreshEach">15</strong> min</span>
      </div>
      <div class="flex items-center gap-2">
        <select id="sourceFilter" class="px-3 py-2 text-sm rounded-lg border bg-white">
          <option value="">Todas as fontes</option>
        </select>
        <input id="searchInput" type="search" placeholder="Buscar notícia…" class="px-3 py-2 text-sm rounded-lg border w-64 max-w-full" />
      </div>
    </div>
  </section>

  <!-- Conteúdo -->
  <main class="max-w-7xl mx-auto px-4 py-6">
    <!-- Manchete -->
    <section>
      <h2 class="text-lg font-semibold mb-3">Manchetes</h2>
      <div id="hero" class="grid md:grid-cols-2 gap-4"></div>
    </section>

    <!-- Lista de notícias -->
    <section class="mt-8">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold">Últimas</h2>
        <span id="countLabel" class="text-sm text-neutral-600"></span>
      </div>
      <div id="feed" class="grid gap-4 news-grid"></div>
      <div id="emptyState" class="hidden text-center text-neutral-500 py-16">
        <p class="mb-2 font-medium">Nenhuma notícia encontrada</p>
        <p class="text-sm">Tente limpar o filtro ou alterar a busca.</p>
      </div>
    </section>

    <!-- Contato -->
    <section id="contato" class="max-w-3xl mx-auto bg-white p-6 mt-10 mb-10 rounded-xl shadow">
      <h2 class="text-xl font-semibold mb-4">Contato — TMA CORP</h2>
      <form action="mailto:tulio.alves@tmalves.com.br" method="POST" enctype="text/plain" class="space-y-3">
        <div>
          <label class="block text-sm font-medium mb-1">Nome</label>
          <input type="text" name="nome" required class="w-full border rounded-lg px-3 py-2" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Telefone</label>
          <input type="text" name="telefone" class="w-full border rounded-lg px-3 py-2" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">E-mail</label>
          <input type="email" name="email" required class="w-full border rounded-lg px-3 py-2" />
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Descrição</label>
          <textarea name="descricao" rows="3" class="w-full border rounded-lg px-3 py-2"></textarea>
        </div>
        <button type="submit" class="bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700">Enviar</button>
      </form>
    </section>
  </main>

  <!-- Rodapé -->
  <footer class="border-t bg-white">
    <div class="max-w-7xl mx-auto px-4 py-6 text-sm text-neutral-600 flex flex-col md:flex-row gap-2 md:items-center md:justify-between">
      <p>© <span id="year"></span> TMA CORP • Curadoria automática de notícias de Telecom.</p>
      <p>As manchetes e links são carregados dos sites de origem (RSS). Nenhum conteúdo é armazenado.</p>
    </div>
  </footer>

  <!-- Floating WhatsApp -->
  <a class="whats-float" href="https://wa.me/5535998993464" target="_blank" aria-label="Falar no WhatsApp">
    <img src="WhatsApp-icone.png" alt="WhatsApp" />
  </a>

  <!-- Modal de Fontes -->
  <dialog id="settingsModal" class="backdrop:bg-black/40 rounded-xl p-0 w-[680px] max-w-[92vw]">
    <form method="dialog" class="p-0">
      <div class="p-4 border-b bg-white rounded-t-xl flex items-center justify-between">
        <h3 class="font-semibold">Fontes de notícias (RSS)</h3>
        <button class="px-2 py-1 text-sm rounded border">Fechar</button>
      </div>
      <div class="p-4 space-y-4 bg-white">
        <p class="text-sm text-neutral-600">Edite as fontes abaixo. Você pode colar outros RSS; o site buscará automaticamente. Dica: use <code>https://api.allorigins.win/raw?url=</code> se algum RSS bloquear CORS.</p>
        <div id="sourcesList" class="space-y-3"></div>
        <div class="flex items-center gap-2">
          <button id="addSource" type="button" class="px-3 py-2 text-sm rounded border">Adicionar fonte</button>
          <button id="saveSources" class="px-3 py-2 text-sm rounded bg-emerald-600 text-white">Salvar e recarregar</button>
        </div>
      </div>
    </form>
  </dialog>

  <script>
    // ================================
    // Configuração inicial
    // ================================
    const DEFAULT_SOURCES = [
      { id: 'g1-tecnologia', name: 'G1 • Tecnologia', url: 'https://g1.globo.com/rss/g1/tecnologia/' },
      { id: 'teletime', name: 'TELETIME', url: 'https://teletime.com.br/feed/' },
      { id: 'telesintese', name: 'TeleSíntese', url: 'https://www.telesintese.com.br/feed/' },
      { id: 'anatel-noticias', name: 'Anatel (Notícias)', url: 'https://www.gov.br/anatel/pt-br/assuntos/noticias/@@RSS' },
      { id: 'convergencia', name: 'Convergência Digital', url: 'https://www.convergenciadigital.com.br/cgi/cgilua.exe/sys/start.htm?tpl=home&rss=1' }
    ];

    const wrapCORS = (url) => `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
    const REFRESH_MINUTES = 15;
    document.getElementById('refreshEach').textContent = REFRESH_MINUTES;
    document.getElementById('year').textContent = new Date().getFullYear();

    const loadSources = () => {
      try {
        const saved = JSON.parse(localStorage.getItem('tm-news-sources'));
        if (Array.isArray(saved) && saved.length) return saved;
      } catch (e) {}
      return DEFAULT_SOURCES;
    };
    const saveSources = (arr) => localStorage.setItem('tm-news-sources', JSON.stringify(arr));
    let SOURCES = loadSources();
    let ALL_ITEMS = [];

    const sourceFilter = document.getElementById('sourceFilter');
    const searchInput = document.getElementById('searchInput');
    const feedEl = document.getElementById('feed');
    const heroEl = document.getElementById('hero');
    const emptyEl = document.getElementById('emptyState');
    const countLabel = document.getElementById('countLabel');

    function populateSourceFilter() {
      sourceFilter.innerHTML = '<option value=\"\">Todas as fontes</option>' + SOURCES.map(s=>`<option value=\"${s.id}\">${s.name}</option>`).join('');
    }

    async function fetchRSS(source) {
      const url = source.url;
      const useProxy = url.startsWith('https://www.gov.br') || url.includes('convergencia');
      const target = useProxy ? wrapCORS(url) : url;
      const res = await fetch(target);
      if (!res.ok) throw new Error('Falha ao buscar: ' + source.name);
      const text = await res.text();
      const parser = new DOMParser();
      const xml = parser.parseFromString(text, 'text/xml');
      if (xml.querySelector('parsererror')) throw new Error('RSS inválido em ' + source.name);
      let items = [...xml.querySelectorAll('item')].map(it=>({
        title: it.querySelector('title')?.textContent?.trim() || 'Sem título',
        link: it.querySelector('link')?.textContent?.trim() || '#',
        pubDate: new Date(it.querySelector('pubDate')?.textContent || it.querySelector('dc\\:date')?.textContent || Date.now()),
        description: it.querySelector('description')?.textContent || '',
        source: source
      }));
      if (!items.length) {
        items = [...xml.querySelectorAll('entry')].map(it=>({
          title: it.querySelector('title')?.textContent?.trim() || 'Sem título',
          link: it.querySelector('link')?.getAttribute('href') || '#',
          pubDate: new Date(it.querySelector('updated')?.textContent || it.querySelector('published')?.textContent || Date.now()),
          description: it.querySelector('summary')?.textContent || it.querySelector('content')?.textContent || '',
          source: source
        }));
      }
      return items;
    }

    function normalizeText(html) {
      const tmp = document.createElement('div');
      tmp.innerHTML = html;
      return tmp.textContent || tmp.innerText || '';
    }

    async function loadAll() {
      setStatus('Carregando…', true);
      const promises = SOURCES.map(s => fetchRSS(s).catch(()=>[]));
      const results = await Promise.all(promises);
      ALL_ITEMS = results.flat().map(x=>({...x, description: normalizeText(x.description)})).sort((a,b)=> b.pubDate - a.pubDate);
      render();
      setStatus('Pronto');
    }

    function setStatus(msg, loading=false){
      const el = document.getElementById('statusText');
      el.textContent = msg;
      const led = document.getElementById('led');
      led.className = 'w-2 h-2 rounded-full ' + (loading ? 'bg-amber-500 pulse' : 'bg-emerald-500');
    }

    function render(){
      const term = searchInput.value.toLowerCase().trim();
      const filter = sourceFilter.value;
      let items = ALL_ITEMS.filter(i => (!filter || i.source.id === filter) && (!term || (i.title + ' ' + i.description).toLowerCase().includes(term)) );
      countLabel.textContent = items.length ? `${items.length} notícias` : '';
      heroEl.innerHTML = items.slice(0,2).map(cardHero).join('');
      feedEl.innerHTML = items.slice(2).map(card).join('');
      emptyEl.classList.toggle('hidden', items.length>0);
    }

    function timeAgo(d){
      const diff = Math.max(0, (Date.now()-d)/1000);
      const map = [ ['d',86400], ['h',3600], ['min',60] ];
      for (const [s,sec] of map){ if (diff>=sec) return `${Math.floor(diff/sec)} ${s}`; }
      return 'agora';
    }

    function safeURL(u){ try { return new URL(u).href } catch(e){ return '#' } }

    function cardHero(item){
      return `
      <article class="rounded-2xl border bg-white overflow-hidden group">
        <a href="${safeURL(item.link)}" target="_blank" rel="noopener" class="block p-5">
          <div class="text-xs text-neutral-500 mb-2 flex items-center gap-2">
            <span class="px-2 py-0.5 rounded-full bg-neutral-100">${item.source.name}</span>
            <span>•</span>
            <time>${timeAgo(item.pubDate)} atrás</time>
          </div>
          <h3 class="text-xl font-bold leading-snug group-hover:underline">${item.title}</h3>
          <p class="mt-2 text-sm text-neutral-700 line-clamp-3">${item.description}</p>
        </a>
      </article>`;
    }

    function card(item){
      return `
      <article class="rounded-xl border bg-white overflow-hidden group">
        <a href="${safeURL(item.link)}" target="_blank" rel="noopener" class="block p-4">
          <div class="text-xs text-neutral-500 mb-1 flex items-center gap-2">
            <span class="px-2 py-0.5 rounded-full bg-neutral-100">${item.source.name}</span>
            <span>•</span>
            <time>${timeAgo(item.pubDate)} atrás</time>
          </div>
          <h3 class="font-semibold leading-snug group-hover:underline line-clamp-2">${item.title}</h3>
          <p class="mt-1 text-sm text-neutral-700 line-clamp-2">${item.description}</p>
        </a>
      </article>`;
    }

    // UI events
    document.getElementById('sourceFilter').addEventListener('change', render);
    document.getElementById('searchInput').addEventListener('input', render);

    // Settings modal logic
    const modal = document.getElementById('settingsModal');
    const openBtn = document.createElement('button');
    openBtn.textContent = 'Fontes';
    openBtn.className = 'px-3 py-2 text-sm rounded-lg border hover:bg-neutral-100 fixed bottom-4 left-4 bg-white z-40';
    openBtn.addEventListener('click', ()=>{ renderSourcesForm(); modal.showModal(); });
    document.body.appendChild(openBtn);

    document.getElementById('addSource').addEventListener('click', () => {
      SOURCES.push({ id: 'fonte-'+Date.now(), name: 'Nova Fonte', url: '' });
      renderSourcesForm();
    });
    document.getElementById('saveSources').addEventListener('click', (e) => {
      e.preventDefault();
      const rows = [...document.querySelectorAll('[data-source-row]')];
      const next = rows.map(r => ({
        id: r.querySelector('[name=id]').value.trim() || ('fonte-'+Math.random().toString(36).slice(2)),
        name: r.querySelector('[name=name]').value.trim() || 'Sem nome',
        url: r.querySelector('[name=url]').value.trim()
      })).filter(x=>x.url);
      saveSources(next);
      SOURCES = loadSources();
      populateSourceFilter();
      modal.close();
      loadAll();
    });

    function renderSourcesForm(){
      const box = document.getElementById('sourcesList');
      box.innerHTML = SOURCES.map(s=>`
        <div class="grid grid-cols-12 gap-2 items-center" data-source-row>
          <input class="col-span-2 px-2 py-2 text-sm border rounded" name="id" value="${s.id}" title="ID (único)" />
          <input class="col-span-4 px-2 py-2 text-sm border rounded" name="name" value="${s.name}" placeholder="Nome da fonte" />
          <input class="col-span-6 px-2 py-2 text-sm border rounded" name="url" value="${s.url}" placeholder="URL do RSS" />
        </div>
      `).join('');
    }

    // Auto-refresh
    setInterval(loadAll, REFRESH_MINUTES*60*1000);

    // Boot
    function populateSourceFilter(){ 
      const el = document.getElementById('sourceFilter');
      el.innerHTML = '<option value=\"\">Todas as fontes</option>' + SOURCES.map(s=>`<option value=\"${s.id}\">${s.name}</option>`).join('');
    }
    populateSourceFilter();
    function setStatusText(){}
    loadAll();
  </script>
</body>
</html>
